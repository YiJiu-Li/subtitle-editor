<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>简易字幕编辑器 - Whisper AI版</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>"
      type="image/svg+xml"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <div class="main-container">
      <!-- 主容器 -->
      <div class="editor-panel">
        <h1 class="title">🎬 简易字幕编辑器</h1>
        <div class="author-info">
          作者:
          <a href="https://github.com/YiJiu-Li" target="_blank">YiJiu-Li</a> |
          <a href="https://github.com/YiJiu-Li" target="_blank">GitHub主页</a>
        </div>

        <!-- 文件控制区 -->
        <div class="control-panel">
          <div class="file-controls">
            <!-- JSON文件选择 -->
            <div class="file-input-wrapper">
              <input type="file" id="jsonFile" accept=".json" />
              <div class="file-input-btn purple">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                选择字幕
              </div>
              <span id="jsonFileName" class="file-name">未选择文件</span>
            </div>

            <!-- 音频文件选择 -->
            <div class="file-input-wrapper">
              <input type="file" id="audioFile" accept="audio/*,video/*" />
              <div class="file-input-btn green">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                </svg>
                选择音频
              </div>
              <span id="audioFileName" class="file-name">未选择文件</span>
            </div>

            <!-- AI转写按钮 -->
            <button id="transcribeBtn" class="btn ai-btn" title="使用Whisper AI转写音频">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
              </svg>
              AI转写
            </button>

            <!-- 保存按钮 -->
            <button id="saveBtn" class="btn orange-btn">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
              </svg>
              保存JSON
            </button>
          </div>

          <!-- 播放控制 -->
          <div class="playback-controls">
            <button id="playBtn" class="btn play-btn">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              播放
            </button>
            <button id="stopBtn" class="btn stop-btn">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
              </svg>
              停止
            </button>
          </div>
        </div>

        <!-- AI转写设置面板 -->
        <div id="transcribePanel" class="transcribe-panel hidden">
          <h3>🤖 Whisper AI 转写设置</h3>
          <div class="transcribe-options">
            <div class="option-group">
              <label for="modelSelect">模型大小:</label>
              <select id="modelSelect">
                <option value="tiny">tiny (最快，准确度较低)</option>
                <option value="base" selected>base (推荐，平衡速度和准确度)</option>
                <option value="small">small (较慢，更准确)</option>
                <option value="medium">medium (慢，高准确度)</option>
                <option value="large">large (最慢，最高准确度)</option>
              </select>
            </div>
            <div class="option-group">
              <label for="languageSelect">语言:</label>
              <select id="languageSelect">
                <option value="zh" selected>中文</option>
                <option value="en">英文</option>
                <option value="ja">日文</option>
                <option value="ko">韩文</option>
                <option value="auto">自动检测</option>
              </select>
            </div>
            <div class="option-group">
              <label for="taskSelect">任务:</label>
              <select id="taskSelect">
                <option value="transcribe" selected>转写 (保持原语言)</option>
                <option value="translate">翻译 (翻译为英文)</option>
              </select>
            </div>
          </div>
          <div class="transcribe-actions">
            <button id="startTranscribeBtn" class="btn ai-btn">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              开始转写
            </button>
            <button id="cancelTranscribeBtn" class="btn gray-btn">取消</button>
          </div>
          <div id="transcribeProgress" class="transcribe-progress hidden">
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
            </div>
            <span id="progressText">准备中...</span>
          </div>
        </div>

        <!-- 时间显示 -->
        <div class="time-display" id="currentTimeDisplay">00:00.00</div>

        <!-- 字幕预览区域 -->
        <div class="subtitle-preview-area" id="subtitlePreviewArea">
          <div class="subtitle-preview" id="currentSubtitlePreview">字幕预览区</div>
        </div>

        <!-- 波形容器 -->
        <div class="waveform-container">
          <div id="waveform"></div>
          <div id="currentTime" class="current-time-marker"></div>
          <div id="previewLine" class="preview-line"></div>
          <div id="timePreview" class="time-preview"></div>
        </div>
        <div id="timeline" class="timeline"></div>

        <!-- 文件名输入 -->
        <div class="filename-input">
          <label>文件名：</label>
          <input type="text" id="filename" placeholder="subtitle-xxxx-zh-speakx.json" />
          <span class="hint">（根据音频文件自动生成）</span>
        </div>

        <!-- 字幕操作按钮 -->
        <div class="subtitle-actions">
          <button id="addSubtitleBtn" class="btn purple-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
            </svg>
            添加字幕
          </button>
          <button id="syncTimeBtn" class="btn outline-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            同步时间
          </button>

          <div class="status-info">
            <span class="label">选中状态:</span>
            <span id="selectionStatus" class="status-badge gray">无</span>
            <span class="divider">|</span>
            <span class="label">字数限制:</span>
            <span class="status-badge purple">每条≤25字</span>
          </div>
        </div>

        <!-- 字幕列表 -->
        <div class="subtitle-list" id="subtitleList"></div>
      </div>

      <!-- 侧边栏 -->
      <div class="sidebar">
        <h2 class="sidebar-title">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          使用说明
        </h2>

        <div class="help-section">
          <h3><span class="step-number">1</span> 基本操作</h3>
          <ul>
            <li>选择JSON文件 - 加载已有字幕文件</li>
            <li>选择音频文件 - 加载音频进行同步</li>
            <li><strong>AI转写</strong> - 使用Whisper自动生成字幕</li>
            <li>保存JSON - 将当前字幕保存为JSON文件</li>
          </ul>
        </div>

        <div class="help-section">
          <h3><span class="step-number">2</span> AI转写功能</h3>
          <ul>
            <li>支持多种模型大小选择</li>
            <li>支持中/英/日/韩等多语言</li>
            <li>可选择转写或翻译任务</li>
            <li>使用CPU运行，无需GPU</li>
          </ul>
        </div>

        <div class="help-section">
          <h3><span class="step-number">3</span> 音频控制</h3>
          <ul>
            <li>播放/暂停 - 控制音频播放</li>
            <li>停止 - 停止音频并回到开头</li>
            <li>点击波形 - 快速跳转到对应时间点</li>
            <li>鼠标悬停 - 预览位置和时间点</li>
          </ul>
        </div>

        <div class="help-section">
          <h3><span class="step-number">4</span> 字幕编辑</h3>
          <ul>
            <li>添加字幕 - 在当前时间点添加新字幕</li>
            <li><strong>选择字幕</strong> - 点击字幕行的空白处选中</li>
            <li>同步时间 - 将选中字幕时间更新为当前播放时间</li>
            <li>跳转 - 跳转到对应字幕的时间点</li>
            <li>删除 - 删除当前字幕</li>
          </ul>
        </div>

        <div class="warning-box yellow">
          <strong>⚠️ 字数限制：</strong>
          <span>每条字幕最多 <strong>25</strong> 个字符</span>
        </div>

        <div class="help-section">
          <h3><span class="step-number">5</span> 数据格式</h3>
          <p>字幕文件使用JSON格式：</p>
          <pre><code>{
  "data": [
    {"time": 0.0, "text": "字幕"},
    ...
  ]
}</code></pre>
        </div>

        <div class="tip-box blue">
          <strong>💡 小技巧：</strong>
          <span>在波形上点击可快速定位，配合"同步时间"功能更高效。</span>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div>
        © 2025 简易字幕编辑器 | 作者:
        <a href="https://github.com/YiJiu-Li" target="_blank">YiJiu-Li</a> |
        <a href="https://github.com/YiJiu-Li" target="_blank">GitHub</a>
        | Powered by Whisper AI
      </div>
    </footer>

    <!-- 脚本引入 -->
    <script src="https://unpkg.com/wavesurfer.js@6.6.4"></script>
    <script src="https://unpkg.com/wavesurfer.js@6.6.4/dist/plugin/wavesurfer.timeline.min.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
